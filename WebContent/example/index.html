<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Crafty</title>
    <style>
    body, html { margin:0; padding: 0; overflow:hidden; font-family:Arial; font-size:20px }
    #cr-stage { border:2px solid black; margin:5px auto; color:white }
    </style>  
  </head>
  <body>
    
    <script src="js/crafty.js"></script>
    <script src="js/source.js"></script> 
    <script src="../tiledmap.js"></script>    
	<script>
  		window.onload = function() {  			   				     			  			  			  			  		  
  			Crafty.init(320, 320);  			  		
  			Crafty.scene("Load", function() {
				
  				//Preload sprites first
  				 Crafty.load([
  				              "img/ground.png",
  				              "img/obstacles.png" 
  				             ], function() {
  					 
  						Crafty.scene("Main");		
  					});  				
  			});
  			
  			Crafty.scene("Load");
  			  			  		
			Crafty.scene("Main", function () {
				
				Crafty.e("2D, DOM, TiledMapBuilder").createWorld( SOURCE_FROM_TILED_MAP_EDITOR, function( tiledmap ){
					
					//Obstacles
					for (var obstacle = 0; obstacle < tiledmap.getLayer('obstacles').length; obstacle++){
						tiledmap.getLayer('obstacles')[obstacle]
							.addComponent("Collision, Obstacle")
							.collision();							
					}
					
					//Fence
					for (var fence = 0; fence < tiledmap.getLayer('fence').length; fence++){
						tiledmap.getLayer('fence')[fence]
							.addComponent("Collision, Fence")
							.collision();							
					}
					
					//Head
					for (var head = 0; head < tiledmap.getLayer('head').length; head++){
						tiledmap.getLayer('head')[head].z = 1000; 																		
					}
																		
				});
				
				//Player
				Crafty.e("2D, DOM, Color, Fourway, Player, Collision")
  			   		.attr({x: 150, y: 100, z: 100, w:30, h:30})  
  			   		.color("red")
  			   		.fourway(3)  			   					
  			   		.collision()
  			   		.bind('Moved', function(from) {
						if(this.hit('Obstacle') || 
						   this.hit('Fence') ){
							this.attr({x: from.x, y:from.y});
						}
					});
  			   		
  			});  			  													
  	}	
	</script>	
  </body>
</html>
